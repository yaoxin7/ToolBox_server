import{K as M,ae as ke,b as ve,d as re,m as me,i as de,af as Ie,ag as _e,f as pe,u as ge,ab as Le,a as S,c as ze,W as Ce,p as Ee,ah as xe,ai as Ne,aj as Oe,ak as Se,_ as we,P as V,h as B,al as Te,w as ye,M as $e,am as Re}from"./el-button-e63b366d.js";import{k as Q,ao as fe,r as k,ap as Ae,ac as Be,l as v,w as ie,P as he,I as be,o as y,e as ue,b as d,d as _,a as w,s as f,f as a,n as ce,C as Me,E as L,c as N,M as J,t as Ve,U as De,B as Ye,F as Pe,q as U,T as Fe,G as Xe,aq as He,D as We,y as je,L as Ke}from"./index-2bb71daf.js";import{b as qe}from"./article-9fd02726.js";import{u as Ze}from"./index-943d12f9.js";import{g as Ge}from"./scroll-87c3a443.js";const Ue=(l,c)=>{if(!M||!l||!c)return!1;const o=l.getBoundingClientRect();let n;return c instanceof Element?n=c.getBoundingClientRect():n={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},o.top<n.bottom&&o.bottom>n.top&&o.right>n.left&&o.left<n.right};var Je="Expected a function";function le(l,c,o){var n=!0,h=!0;if(typeof l!="function")throw new TypeError(Je);return ke(o)&&(n="leading"in o?!!o.leading:n,h="trailing"in o?!!o.trailing:h),qe(l,c,{leading:n,maxWait:c,trailing:h})}const Qe=ve({urlList:{type:re(Array),default:()=>me([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),et={close:()=>!0,switch:l=>de(l)},tt=["src"],at=Q({name:"ElImageViewer"}),nt=Q({...at,props:Qe,emits:et,setup(l,{expose:c,emit:o}){const n=l,h={CONTAIN:{name:"contain",icon:fe(Ie)},ORIGINAL:{name:"original",icon:fe(_e)}},{t:z}=pe(),i=ge("image-viewer"),{nextZIndex:ee}=Le(),T=k(),O=k([]),C=Ae(),I=k(!0),m=k(n.initialIndex),p=Be(h.CONTAIN),u=k({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),D=v(()=>{const{urlList:e}=n;return e.length<=1}),R=v(()=>m.value===0),X=v(()=>m.value===n.urlList.length-1),te=v(()=>n.urlList[m.value]),ae=v(()=>[i.e("btn"),i.e("prev"),i.is("disabled",!n.infinite&&R.value)]),Y=v(()=>[i.e("btn"),i.e("next"),i.is("disabled",!n.infinite&&X.value)]),ne=v(()=>{const{scale:e,deg:s,offsetX:r,offsetY:g,enableTransition:E}=u.value;let b=r/e,x=g/e;switch(s%360){case 90:case-270:[b,x]=[x,-b];break;case 180:case-180:[b,x]=[-b,-x];break;case 270:case-90:[b,x]=[-x,b];break}const A={transform:`scale(${e}) rotate(${s}deg) translate(${b}px, ${x}px)`,transition:E?"transform .3s":""};return p.value.name===h.CONTAIN.name&&(A.maxWidth=A.maxHeight="100%"),A}),H=v(()=>de(n.zIndex)?n.zIndex:ee());function $(){oe(),o("close")}function se(){const e=le(r=>{switch(r.code){case B.esc:n.closeOnPressEscape&&$();break;case B.space:q();break;case B.left:Z();break;case B.up:t("zoomIn");break;case B.right:G();break;case B.down:t("zoomOut");break}}),s=le(r=>{const g=r.deltaY||r.deltaX;t(g<0?"zoomIn":"zoomOut",{zoomRate:n.zoomRate,enableTransition:!1})});C.run(()=>{V(document,"keydown",e),V(document,"wheel",s)})}function oe(){C.stop()}function W(){I.value=!1}function j(e){I.value=!1,e.target.alt=z("el.image.error")}function K(e){if(I.value||e.button!==0||!T.value)return;u.value.enableTransition=!1;const{offsetX:s,offsetY:r}=u.value,g=e.pageX,E=e.pageY,b=le(A=>{u.value={...u.value,offsetX:s+A.pageX-g,offsetY:r+A.pageY-E}}),x=V(document,"mousemove",b);V(document,"mouseup",()=>{x()}),e.preventDefault()}function P(){u.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function q(){if(I.value)return;const e=Te(h),s=Object.values(h),r=p.value.name,E=(s.findIndex(b=>b.name===r)+1)%e.length;p.value=h[e[E]],P()}function F(e){const s=n.urlList.length;m.value=(e+s)%s}function Z(){R.value&&!n.infinite||F(m.value-1)}function G(){X.value&&!n.infinite||F(m.value+1)}function t(e,s={}){if(I.value)return;const{zoomRate:r,rotateDeg:g,enableTransition:E}={zoomRate:n.zoomRate,rotateDeg:90,enableTransition:!0,...s};switch(e){case"zoomOut":u.value.scale>.2&&(u.value.scale=Number.parseFloat((u.value.scale/r).toFixed(3)));break;case"zoomIn":u.value.scale<7&&(u.value.scale=Number.parseFloat((u.value.scale*r).toFixed(3)));break;case"clockwise":u.value.deg+=g;break;case"anticlockwise":u.value.deg-=g;break}u.value.enableTransition=E}return ie(te,()=>{he(()=>{const e=O.value[0];e!=null&&e.complete||(I.value=!0)})}),ie(m,e=>{P(),o("switch",e)}),be(()=>{var e,s;se(),(s=(e=T.value)==null?void 0:e.focus)==null||s.call(e)}),c({setActiveItem:F}),(e,s)=>(y(),ue(Xe,{to:"body",disabled:!e.teleported},[d(Fe,{name:"viewer-fade",appear:""},{default:_(()=>[w("div",{ref_key:"wrapper",ref:T,tabindex:-1,class:f(a(i).e("wrapper")),style:ce({zIndex:a(H)})},[w("div",{class:f(a(i).e("mask")),onClick:s[0]||(s[0]=Me(r=>e.hideOnClickModal&&$(),["self"]))},null,2),L(" CLOSE "),w("span",{class:f([a(i).e("btn"),a(i).e("close")]),onClick:$},[d(a(S),null,{default:_(()=>[d(a(ze))]),_:1})],2),L(" ARROW "),a(D)?L("v-if",!0):(y(),N(J,{key:0},[w("span",{class:f(a(ae)),onClick:Z},[d(a(S),null,{default:_(()=>[d(a(Ce))]),_:1})],2),w("span",{class:f(a(Y)),onClick:G},[d(a(S),null,{default:_(()=>[d(a(Ee))]),_:1})],2)],64)),L(" ACTIONS "),w("div",{class:f([a(i).e("btn"),a(i).e("actions")])},[w("div",{class:f(a(i).e("actions__inner"))},[d(a(S),{onClick:s[1]||(s[1]=r=>t("zoomOut"))},{default:_(()=>[d(a(xe))]),_:1}),d(a(S),{onClick:s[2]||(s[2]=r=>t("zoomIn"))},{default:_(()=>[d(a(Ne))]),_:1}),w("i",{class:f(a(i).e("actions__divider"))},null,2),d(a(S),{onClick:q},{default:_(()=>[(y(),ue(Ve(a(p).icon)))]),_:1}),w("i",{class:f(a(i).e("actions__divider"))},null,2),d(a(S),{onClick:s[3]||(s[3]=r=>t("anticlockwise"))},{default:_(()=>[d(a(Oe))]),_:1}),d(a(S),{onClick:s[4]||(s[4]=r=>t("clockwise"))},{default:_(()=>[d(a(Se))]),_:1})],2)],2),L(" CANVAS "),w("div",{class:f(a(i).e("canvas"))},[(y(!0),N(J,null,De(e.urlList,(r,g)=>Ye((y(),N("img",{ref_for:!0,ref:E=>O.value[g]=E,key:r,src:r,style:ce(a(ne)),class:f(a(i).e("img")),onLoad:W,onError:j,onMousedown:K},null,46,tt)),[[Pe,g===m.value]])),128))],2),U(e.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var st=we(nt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const ot=ye(st),lt=ve({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:re([String,Object])},previewSrcList:{type:re(Array),default:()=>me([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),rt={load:l=>l instanceof Event,error:l=>l instanceof Event,switch:l=>de(l),close:()=>!0,show:()=>!0},it=["src","loading"],ut={key:0},ct=Q({name:"ElImage",inheritAttrs:!1}),dt=Q({...ct,props:lt,emits:rt,setup(l,{emit:c}){const o=l;let n="";const{t:h}=pe(),z=ge("image"),i=He(),ee=Ze(),T=k(),O=k(!1),C=k(!0),I=k(!1),m=k(),p=k(),u=M&&"loading"in HTMLImageElement.prototype;let D,R;const X=v(()=>[z.e("inner"),Y.value&&z.e("preview"),C.value&&z.is("loading")]),te=v(()=>i.style),ae=v(()=>{const{fit:t}=o;return M&&t?{objectFit:t}:{}}),Y=v(()=>{const{previewSrcList:t}=o;return Array.isArray(t)&&t.length>0}),ne=v(()=>{const{previewSrcList:t,initialIndex:e}=o;let s=e;return e>t.length-1&&(s=0),s}),H=v(()=>o.loading==="eager"?!1:!u&&o.loading==="lazy"||o.lazy),$=()=>{M&&(C.value=!0,O.value=!1,T.value=o.src)};function se(t){C.value=!1,O.value=!1,c("load",t)}function oe(t){C.value=!1,O.value=!0,c("error",t)}function W(){Ue(m.value,p.value)&&($(),P())}const j=Re(W,200,!0);async function K(){var t;if(!M)return;await he();const{scrollContainer:e}=o;$e(e)?p.value=e:Ke(e)&&e!==""?p.value=(t=document.querySelector(e))!=null?t:void 0:m.value&&(p.value=Ge(m.value)),p.value&&(D=V(p,"scroll",j),setTimeout(()=>W(),100))}function P(){!M||!p.value||!j||(D==null||D(),p.value=void 0)}function q(t){if(t.ctrlKey){if(t.deltaY<0)return t.preventDefault(),!1;if(t.deltaY>0)return t.preventDefault(),!1}}function F(){Y.value&&(R=V("wheel",q,{passive:!1}),n=document.body.style.overflow,document.body.style.overflow="hidden",I.value=!0,c("show"))}function Z(){R==null||R(),document.body.style.overflow=n,I.value=!1,c("close")}function G(t){c("switch",t)}return ie(()=>o.src,()=>{H.value?(C.value=!0,O.value=!1,P(),K()):$()}),be(()=>{H.value?K():$()}),(t,e)=>(y(),N("div",{ref_key:"container",ref:m,class:f([a(z).b(),t.$attrs.class]),style:ce(a(te))},[O.value?U(t.$slots,"error",{key:0},()=>[w("div",{class:f(a(z).e("error"))},We(a(h)("el.image.error")),3)]):(y(),N(J,{key:1},[T.value!==void 0?(y(),N("img",je({key:0},a(ee),{src:T.value,loading:t.loading,style:a(ae),class:a(X),onClick:F,onLoad:se,onError:oe}),null,16,it)):L("v-if",!0),C.value?(y(),N("div",{key:1,class:f(a(z).e("wrapper"))},[U(t.$slots,"placeholder",{},()=>[w("div",{class:f(a(z).e("placeholder"))},null,2)])],2)):L("v-if",!0)],64)),a(Y)?(y(),N(J,{key:2},[I.value?(y(),ue(a(ot),{key:0,"z-index":t.zIndex,"initial-index":a(ne),infinite:t.infinite,"zoom-rate":t.zoomRate,"url-list":t.previewSrcList,"hide-on-click-modal":t.hideOnClickModal,teleported:t.previewTeleported,"close-on-press-escape":t.closeOnPressEscape,onClose:Z,onSwitch:G},{default:_(()=>[t.$slots.viewer?(y(),N("div",ut,[U(t.$slots,"viewer")])):L("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):L("v-if",!0)],64)):L("v-if",!0)],6))}});var ft=we(dt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const yt=ye(ft);const ht=l=>{const c=l.getFullYear(),o=l.getMonth()+1,n=l.getDate();return`${c}年${o}月${n}日`};export{yt as E,ht as f};
