import{N as w,Y as C,E as M,a as N}from"./el-button-e63b366d.js";import{E as O,a as q,c as H}from"./el-main-7a57110f.js";import{E as j,a as K}from"./el-form-item-5e871bc7.js";import{E as W}from"./el-input-6f8a8ef8.js";import{a as X,E as Y}from"./el-select-21853ecf.js";import"./el-scrollbar-ae1ad2ca.js";import{E as z}from"./el-progress-9cd6b9ad.js";import{u as G}from"./userinfo-441d26cd.js";import{r as v,o as u,e as d,d as o,q as J,_ as Q,R as Z,b as t,a as F,f as c,D as h,c as U,U as R,M as S,h as g}from"./index-2bb71daf.js";/* empty css                */import{b as A,E as ee}from"./request-d319ce4c.js";import{p as le}from"./article-9fd02726.js";/* empty css                   */import"./event-0e1210c4.js";import"./index-943d12f9.js";import"./scroll-87c3a443.js";import"./isEqual-f1fd590b.js";import"./focus-trap-fc61f8de.js";const ae={__name:"UploadComp",props:{fileList:{type:Array,default:()=>[]}},emits:["uploadFinish","update:file-list"],setup(x,{expose:y,emit:_}){const e=v();y({uploadRef:e});const b=r=>{_("uploadFinish",r.data)},E=r=>{const p=new FormData;return p.append("file",r.file),G(p)};return(r,p)=>{const m=z;return u(),d(m,{ref_key:"uploadRef",ref:e,"auto-upload":!1,"on-success":b,"http-request":E},{default:o(()=>[J(r.$slots,"default")]),_:3},512)}}};const te={class:"back"},oe={class:"title"},ue=["src"],re={__name:"CreateArticlePage",setup(x){const y=Z(),_=v(),e=v({title:"",cover_image_url:"",intro:"",status:"",type:"",data_url:[""]}),b=[],E=[{label:"文章",value:"TEXT"},{label:"图片",value:"PICTURES"},{label:"视频",value:"VIDEO"},{label:"markdown",value:"MARKDOWN"}],r=v(e.value.data_url.map(n=>({name:n,url:A+"/upload/"+n}))),p=async()=>{const n={...e.value,data_url:e.value.data_url.join(",")};await le(n),ee.success("发布成功"),y.back()},m=n=>{e.value.status=n,p()};return(n,a)=>{const f=M,D=q,i=W,s=j,k=N,V=ae,I=Y,P=X,B=K,L=H,T=O;return u(),d(T,null,{default:o(()=>[t(D,{class:"header"},{default:o(()=>[F("div",te,[t(f,{icon:c(w),onClick:a[0]||(a[0]=l=>n.$router.back()),type:"info",plain:"",circle:""},null,8,["icon"])]),F("div",oe,h(e.value.id?"修改动态":"创建动态"),1)]),_:1}),t(L,null,{default:o(()=>[t(B,{class:"main_form",model:e.value,rules:b,"label-position":"top"},{default:o(()=>[t(s,{label:"标题",prop:"title"},{default:o(()=>[t(i,{modelValue:e.value.title,"onUpdate:modelValue":a[1]||(a[1]=l=>e.value.title=l)},null,8,["modelValue"])]),_:1}),t(s,{label:"封面图片"},{default:o(()=>[t(V,{onUploadFinish:a[2]||(a[2]=l=>e.value.cover_image_url=l.data.url),"auto-upload":!0,class:"avatar-uploader"},{default:o(()=>[e.value.cover_image_url?(u(),U("img",{key:0,src:c(A)+"/upload/"+e.value.cover_image_url,class:"avatar",alt:"error"},null,8,ue)):(u(),d(k,{key:1,class:"avatar-uploader-icon"},{default:o(()=>[t(c(C))]),_:1}))]),_:1}),t(i,{class:"input_url",modelValue:e.value.cover_image_url,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.cover_image_url=l)},null,8,["modelValue"])]),_:1}),t(s,{label:"简介",prop:"intro"},{default:o(()=>[t(i,{modelValue:e.value.intro,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.intro=l),type:"textarea"},null,8,["modelValue"])]),_:1}),t(s,{label:"类型"},{default:o(()=>[t(P,{modelValue:e.value.type,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.type=l),placeholder:"Select"},{default:o(()=>[(u(),U(S,null,R(E,l=>t(I,{label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e.value.type==="PICTURES"?(u(),d(s,{key:0,label:"上传图片"},{default:o(()=>[t(V,{ref_key:"uploadFileRef",ref:_,"auto-upload":!0,"file-list":r.value,"onUpdate:fileList":a[6]||(a[6]=l=>r.value=l),onUploadFinish:a[7]||(a[7]=l=>e.value.data_url.push(l.data.url)),"list-type":"picture-card"},{default:o(()=>[t(k,null,{default:o(()=>[t(c(C))]),_:1})]),_:1},8,["file-list"]),t(i,{class:"input_url",modelValue:e.value.data_url,"onUpdate:modelValue":a[8]||(a[8]=l=>e.value.data_url=l)},null,8,["modelValue"])]),_:1})):(u(),d(s,{key:1,label:"上传文件"},{default:o(()=>[t(V,{ref_key:"uploadFileRef",ref:_,"auto-upload":!0,onUploadFinish:a[9]||(a[9]=l=>e.value.data_url.push(l.data.url))},{default:o(()=>[t(f,{type:"primary"},{default:o(()=>[g("选择文件")]),_:1})]),_:1},512),(u(!0),U(S,null,R(e.value.data_url.length,l=>(u(),d(i,{class:"input_url",modelValue:e.value.data_url[l-1],"onUpdate:modelValue":$=>e.value.data_url[l-1]=$},null,8,["modelValue","onUpdate:modelValue"]))),256))]),_:1})),t(s,null,{default:o(()=>[t(f,{type:"primary",onClick:a[10]||(a[10]=l=>m("PUBLISHED")),round:""},{default:o(()=>[g("提交")]),_:1}),t(f,{type:"info",round:"",onClick:a[11]||(a[11]=l=>m("DRAFT"))},{default:o(()=>[g("草稿")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})}}},Fe=Q(re,[["__scopeId","data-v-145121df"]]);export{Fe as default};
